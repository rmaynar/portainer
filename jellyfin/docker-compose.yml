version: '3.8'

services:
  # -----------------------------------------------------------------
  # 1. JELLYFIN MEDIA SERVER
  # -----------------------------------------------------------------
  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ} 
    volumes:
      - ${JELLYFIN_BASE_PATH}/config:/config
      - ${JELLYFIN_BASE_PATH}/cache:/cache
      - /media/usb-drive:/media 
    ports:
      - 8096:8096
    restart: unless-stopped
    # OPTIONAL: Hardware Acceleration (Uncomment if needed)
    devices:
      - /dev/dri:/dev/dri
  # -----------------------------------------------------------------
  # 2. THREADFIN IPTV PROXY
  # -----------------------------------------------------------------
  threadfin:
    image: fyb3roptik/threadfin
    container_name: threadfin
    environment:
      # Uses the SAME variables as Jellyfin for file permissions
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ} 
    volumes:
      # Host path for Threadfin's configuration and EPG data
      - ${JELLYFIN_BASE_PATH}/threadfin/config:/home/threadfin/conf
    ports:
      # Access the Threadfin Web UI here: http://<IP>:34400
      - 34400:34400 
    restart: unless-stopped
    
